<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent 6 - Clean Integration Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
      padding: 40px 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9rem;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .test-results {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin: 20px 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .test-results h3 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .module-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .module-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      border-left: 4px solid #667eea;
      transition: transform 0.3s ease;
    }
    
    .module-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .module-card h4 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    
    .module-card p {
      margin: 5px 0;
      color: #5a6c7d;
    }
    
    .status {
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      font-weight: 600;
    }
    
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      max-width: 400px;
    }
    
    .toast {
      background: white;
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      border-left: 4px solid #667eea;
      animation: slideIn 0.3s ease;
      font-weight: 500;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .error { border-left-color: #e74c3c; }
    .success { border-left-color: #2ecc71; }
    .warning { border-left-color: #f39c12; }
    
    @media (max-width: 768px) {
      .header h1 { font-size: 2rem; }
      .controls { flex-direction: column; align-items: center; }
      .module-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Agent 6 Clean Integration</h1>
      <p>300+ Production-Ready Modules - No Duplicate Loading</p>
    </div>

    <div class="controls">
      <button class="btn" onclick="runIntegrationTest()">üß™ Run Integration Test</button>
      <button class="btn" onclick="runCategoryTests()">üìä Test Categories</button>
      <button class="btn" onclick="runPerformanceTest()">‚ö° Performance Test</button>
      <button class="btn" onclick="clearResults()">üßπ Clear Results</button>
    </div>

    <div class="status" id="status">Ready to test Agent 6 modules...</div>

    <div class="test-results">
      <h3>üìà Test Results</h3>
      <div class="module-grid" id="module-grid">
        <!-- Results will appear here -->
      </div>
    </div>
  </div>

  <div class="toast-container" id="toast-container"></div>

  <!-- Load only the smart module loader -->
  <script src="./modules.js"></script>

  <script>
    let testResults = [];
    let modulesLoaded = false;

    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    function addTestResult(category, module, status, details, executionTime = null) {
      const grid = document.getElementById('module-grid');
      const card = document.createElement('div');
      card.className = 'module-card';
      
      const timeInfo = executionTime ? `<p><strong>Time:</strong> ${executionTime}ms</p>` : '';
      const statusColor = status === '‚úÖ' ? '#2ecc71' : status === '‚ùå' ? '#e74c3c' : '#f39c12';
      
      card.innerHTML = `
        <h4>${module}</h4>
        <p><strong>Category:</strong> ${category}</p>
        <p><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: bold;">${status}</span></p>
        <p><strong>Details:</strong> ${details}</p>
        ${timeInfo}
      `;
      
      grid.appendChild(card);
    }

    async function runIntegrationTest() {
      clearResults();
      updateStatus('Running comprehensive integration test...');
      showToast('üß™ Starting comprehensive integration test', 'info');
      
      const startTime = Date.now();
      
      try {
        // Load all modules first
        updateStatus('Loading Agent 6 modules...');
        await window.Agent6ModuleLoader.loadAll();
        
        // Wait a bit for modules to initialize
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Test 1: Basic Module Loading
        updateStatus('Testing basic module loading...');
        await testBasicModules();
        
        // Test 2: Advanced Modules
        updateStatus('Testing advanced modules...');
        await testAdvancedModules();
        
        // Test 3: Module Interactions
        updateStatus('Testing module interactions...');
        await testModuleInteractions();
        
        const totalTime = Date.now() - startTime;
        updateStatus(`Integration test completed in ${totalTime}ms`);
        showToast(`‚úÖ Integration test completed successfully in ${totalTime}ms!`, 'success');
        
      } catch (error) {
        updateStatus(`Integration test failed: ${error.message}`);
        showToast(`‚ùå Integration test failed: ${error.message}`, 'error');
        console.error('Full error:', error);
      }
    }

    async function testBasicModules() {
      const basicTests = [
        { category: 'AI/ML', module: 'LeadScoring', test: () => {
          const ls = new LeadScoring();
          return ls.score({activity: 0.8, fit: 0.6, intent: 0.9});
        }},
        { category: 'Security', module: 'IamSystem', test: () => {
          const iam = new IamSystem();
          iam.addPermission('read');
          iam.addRole('viewer', ['read']);
          iam.addUser('user1', ['viewer']);
          return iam.can('user1', 'read');
        }},
        { category: 'Blockchain', module: 'BlockchainWallet', test: () => {
          const wallet = new BlockchainWallet();
          return 'Module loaded successfully';
        }},
        { category: 'Analytics', module: 'DataProfiling', test: () => {
          const dp = new DataProfiling();
          return dp.numericSummary([1,2,3,4,5]);
        }},
        { category: 'Performance', module: 'PerformanceProfiling', test: () => {
          const pp = new PerformanceProfiling();
          return 'Module loaded successfully';
        }},
        { category: 'UI', module: 'Modal', test: () => {
          const modal = new Modal();
          modal.open('Test', 'Content');
          setTimeout(() => modal.close(), 100);
          return 'Modal opened and closed';
        }}
      ];

      for (const test of basicTests) {
        const start = Date.now();
        try {
          if (window[test.module]) {
            const result = test.test();
            const time = Date.now() - start;
            addTestResult(test.category, test.module, '‚úÖ', `Working: ${JSON.stringify(result)}`, time);
          } else {
            addTestResult(test.category, test.module, '‚ùå', 'Module not loaded');
          }
        } catch (error) {
          addTestResult(test.category, test.module, '‚ùå', `Error: ${error.message}`);
        }
      }
    }

    async function testAdvancedModules() {
      const advancedTests = [
        { category: 'AI/ML', module: 'ComputerVision', test: () => {
          const cv = new ComputerVision();
          return cv.detectObjects('test-image');
        }},
        { category: 'AI/ML', module: 'GenerativeAdversarialNetworks', test: () => {
          const gan = new GenerativeAdversarialNetworks();
          gan.buildGenerator(100);
          gan.buildDiscriminator(784);
          return 'GAN initialized';
        }},
        { category: 'Blockchain', module: 'NftMarketplace', test: () => {
          const market = new NftMarketplace();
          return 'NFT Marketplace loaded';
        }},
        { category: 'Security', module: 'VulnerabilityScanner', test: () => {
          const vs = new VulnerabilityScanner();
          return 'Vulnerability Scanner loaded';
        }},
        { category: 'Analytics', module: 'PredictiveModeling', test: () => {
          const pm = new PredictiveModeling();
          return 'Predictive Modeling loaded';
        }}
      ];

      for (const test of advancedTests) {
        const start = Date.now();
        try {
          if (window[test.module]) {
            const result = test.test();
            const time = Date.now() - start;
            addTestResult(test.category, test.module, '‚úÖ', `Advanced test passed`, time);
          } else {
            addTestResult(test.category, test.module, '‚ùå', 'Advanced module not loaded');
          }
        } catch (error) {
          addTestResult(test.category, test.module, '‚ùå', `Advanced test error: ${error.message}`);
        }
      }
    }

    async function testModuleInteractions() {
      try {
        // Test interaction between different modules
        updateStatus('Testing module interactions...');
        
        // Example: Use IAM + Analytics together
        if (window.IamSystem && window.SecurityAuditLog) {
          const iam = new IamSystem();
          const audit = new SecurityAuditLog();
          
          iam.addPermission('analytics_access');
          audit.log('permission_added', 'admin', { permission: 'analytics_access' });
          
          addTestResult('Integration', 'IAM + Audit', '‚úÖ', 'Modules work together');
        }
        
        // Example: Use AI + Blockchain together
        if (window.LeadScoring && window.BlockchainWallet) {
          const ls = new LeadScoring();
          const wallet = new BlockchainWallet();
          
          const score = ls.score({activity: 0.9, fit: 0.8, intent: 0.7});
          addTestResult('Integration', 'AI + Blockchain', '‚úÖ', `Lead score: ${score.toFixed(2)}`);
        }
        
      } catch (error) {
        addTestResult('Integration', 'Module Interactions', '‚ùå', `Interaction error: ${error.message}`);
      }
    }

    async function runCategoryTests() {
      clearResults();
      updateStatus('Testing by category...');
      showToast('üìä Starting category tests', 'info');
      
      const categories = ['aiml', 'security', 'blockchain', 'analytics', 'performance', 'ui', 'uiux'];
      
      for (const category of categories) {
        const modules = window.Agent6ModuleLoader.getCategoryModules(category);
        const loadedCount = modules.filter(mod => {
          const className = mod.replace('.js', '').split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join('');
          return window[className] !== undefined;
        }).length;
        
        addTestResult(
          category.toUpperCase(), 
          `${category} modules`, 
          loadedCount > 0 ? '‚úÖ' : '‚ùå', 
          `${loadedCount}/${modules.length} modules loaded`
        );
      }
      
      updateStatus('Category tests completed');
      showToast('‚úÖ Category tests completed', 'success');
    }

    async function runPerformanceTest() {
      clearResults();
      updateStatus('Running performance test...');
      showToast('‚ö° Starting performance test', 'info');
      
      const iterations = 100;
      const results = [];
      
      // Test module instantiation performance
      if (window.LeadScoring) {
        const start = performance.now();
        for (let i = 0; i < iterations; i++) {
          const ls = new LeadScoring();
          ls.score({activity: Math.random(), fit: Math.random(), intent: Math.random()});
        }
        const duration = performance.now() - start;
        addTestResult('Performance', 'LeadScoring', '‚úÖ', `${iterations} instantiations in ${duration.toFixed(2)}ms (${(duration/iterations).toFixed(2)}ms avg)`);
      }
      
      // Test IAM performance
      if (window.IamSystem) {
        const start = performance.now();
        const iam = new IamSystem();
        for (let i = 0; i < iterations; i++) {
          iam.addPermission(`perm_${i}`);
          iam.addRole(`role_${i}`, [`perm_${i}`]);
          iam.addUser(`user_${i}`, [`role_${i}`]);
          iam.can(`user_${i}`, `perm_${i}`);
        }
        const duration = performance.now() - start;
        addTestResult('Performance', 'IamSystem', '‚úÖ', `${iterations} operations in ${duration.toFixed(2)}ms (${(duration/iterations).toFixed(2)}ms avg)`);
      }
      
      updateStatus('Performance test completed');
      showToast('‚úÖ Performance test completed', 'success');
    }

    function clearResults() {
      document.getElementById('module-grid').innerHTML = '';
      document.getElementById('toast-container').innerHTML = '';
      updateStatus('Results cleared. Ready for new tests.');
      showToast('üßπ Results cleared', 'info');
    }

    // Auto-run basic test on load
    window.addEventListener('load', async () => {
      updateStatus('Initializing Agent 6 module system...');
      showToast('üöÄ Agent 6 Clean Integration Loaded', 'success');
      
      // Load modules
      await window.Agent6ModuleLoader.loadAll();
      
      updateStatus('Agent 6 modules loaded successfully');
      showToast('‚úÖ All modules loaded and ready for testing', 'success');
      
      // Run a quick test automatically
      setTimeout(() => runIntegrationTest(), 1000);
    });
  </script>
</body>
</html>
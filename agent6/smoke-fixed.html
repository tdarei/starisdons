<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Agent 6 Smoke Test - Fixed</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { color: #2c3e50; margin-bottom: 30px; }
    .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 400px; }
    .toast { background: white; padding: 15px 20px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 4px solid #3498db; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .controls { margin: 20px 0; }
    button { background: #3498db; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #2980b9; }
    .status { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>ðŸš€ Agent 6 Smoke Test - Fixed Version</h1>
  
  <div class="controls">
    <button onclick="runTests()">ðŸ§ª Run Tests</button>
    <button onclick="clearToasts()">ðŸ§¹ Clear</button>
  </div>

  <div class="status" id="status">Ready to test modules...</div>
  
  <div id="toast-container"></div>

  <!-- Load modules using the smart loader -->
  <script src="./modules.js"></script>

  <script>
    const tq = {
      enqueue: function(message) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        container.appendChild(toast);
        
        setTimeout(() => {
          toast.style.animation = 'slideIn 0.3s ease reverse';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
    };

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    function clearToasts() {
      document.getElementById('toast-container').innerHTML = '';
    }

    async function runTests() {
      clearToasts();
      updateStatus('Running module tests...');
      
      try {
        // Test basic functionality
        tq.enqueue('ðŸ§ª Starting Agent 6 module tests...');
        
        // Wait for modules to load
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Test 1: Lead Scoring
        if (window.LeadScoring) {
          const ls = new LeadScoring();
          const score = ls.score({activity: 0.8, fit: 0.6, intent: 0.9});
          tq.enqueue(`âœ… LeadScoring: ${score.toFixed(2)}`);
        } else {
          tq.enqueue('âŒ LeadScoring not available');
        }
        
        // Test 2: IAM System
        if (window.IamSystem) {
          const iam = new IamSystem();
          iam.addPermission('read');
          iam.addRole('viewer', ['read']);
          iam.addUser('user1', ['viewer']);
          const canRead = iam.can('user1', 'read');
          tq.enqueue(`âœ… IAM: Can read = ${canRead}`);
        } else {
          tq.enqueue('âŒ IamSystem not available');
        }
        
        // Test 3: Blockchain Wallet
        if (window.BlockchainWallet) {
          const wallet = new BlockchainWallet();
          tq.enqueue('âœ… BlockchainWallet: Module loaded');
        } else {
          tq.enqueue('âŒ BlockchainWallet not available');
        }
        
        // Test 4: Computer Vision
        if (window.ComputerVision) {
          const cv = new ComputerVision();
          const objects = cv.detectObjects('test');
          tq.enqueue(`âœ… ComputerVision: ${objects.length} objects detected`);
        } else {
          tq.enqueue('âŒ ComputerVision not available');
        }
        
        // Test 5: Modal
        if (window.Modal) {
          const modal = new Modal();
          modal.open('Test', 'This is a test modal');
          setTimeout(() => modal.close(), 1000);
          tq.enqueue('âœ… Modal: Opened and closed');
        } else {
          tq.enqueue('âŒ Modal not available');
        }
        
        updateStatus('Tests completed successfully!');
        tq.enqueue('ðŸŽ‰ All tests completed!');
        
      } catch (error) {
        updateStatus(`Test failed: ${error.message}`);
        tq.enqueue(`âŒ Test failed: ${error.message}`);
        console.error('Full error:', error);
      }
    }

    // Auto-run tests on load
    window.addEventListener('load', async () => {
      updateStatus('Loading Agent 6 modules...');
      await window.Agent6ModuleLoader.loadAll();
      updateStatus('Modules loaded. Ready for testing.');
      tq.enqueue('ðŸš€ Agent 6 modules loaded successfully!');
    });
  </script>
</body>
</html>
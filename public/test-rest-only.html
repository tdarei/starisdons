<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test REST API Only</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; background: #111; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
        button { background: #0f0; color: #000; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Test REST API (No WebSocket)</h1>
    <p>Testing if REST API works - this should work even if WebSocket doesn't</p>
    <button onclick="testREST()">Test REST API</button>
    <button onclick="testStreaming()">Test REST Streaming</button>
    <div id="log"></div>

    <script>
        const API_KEY = new URLSearchParams(window.location.search).get('key') || localStorage.getItem('GOOGLE_API_KEY') || '';
        const TEST_PROMPT = 'Say hello if you can read this';

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            console.log(msg);
        }

        async function testREST() {
            document.getElementById('log').innerHTML = '';
            log('üåê Testing REST API with gemini-2.5-flash (standard model)...', 'info');
            
            try {
                // Use standard model for REST generateContent
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: TEST_PROMPT }] }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1024
                            }
                        })
                    }
                );

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const data = await response.json();
                const responseText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response';
                
                log(`‚úÖ SUCCESS! Response: "${responseText}"`, 'success');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testStreaming() {
            document.getElementById('log').innerHTML = '';
            log('üåä Testing REST Streaming with gemini-2.5-flash-live...', 'info');
            
            try {
                // Try gemini-2.5-flash-live with streaming (this should work)
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-live:streamGenerateContent?key=${API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: TEST_PROMPT }] }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1024
                            }
                        })
                    }
                );

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = '';

                log('üì° Receiving stream...', 'info');
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n').filter(line => line.trim());

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.substring(6));
                                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                                if (text) {
                                    fullResponse += text;
                                    log(`üìù Chunk: "${text}"`, 'info');
                                }
                            } catch (e) {
                                // Skip invalid JSON
                            }
                        }
                    }
                }

                log(`‚úÖ SUCCESS! Full response: "${fullResponse}"`, 'success');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>


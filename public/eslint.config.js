// ESLint Configuration for GitLab Repository
// Enhanced with security and code quality plugins
import security from 'eslint-plugin-security';
import sonarjs from 'eslint-plugin-sonarjs';

export default [
    // Global Ignores to prevent EMFILE and binary/large file scans
    {
        ignores: [
            "**/node_modules/**",
            "node_modules/",
            "**/dist/**",
            "dist/",
            "**/public/**",
            "public/",
            "**/swf/**",
            "**/images/**",
            "**/audio/**",
            "**/*.min.js",
            "**/kepler_data_parsed.js",
            "**/*.json",
            "**/*.map",
            "package-lock.json",
            "package.json",
            "**/*.log",
            "**/*.txt",
            "**/*.md",
            "**/*.css",
            "**/*.html",
            "**/experimental/**",
            "**/*.bik",
            "**/*.dat",
            "**/*.pack",
            "**/*.exe",
            "**/*.dll",
            "**/*.tga",
            "**/*.sav",
            "**/*.cab",
            "**/*.wfc",
            "**/*.rwm",
            "**/*.idx",
            "**/*.hgt",
            "**/*.py",
            "**/*.yaml",
            "**/*.yml",
            "**/*.service",
            "**/*.sh",
            "**/Dockerfile",
            "**/*.sol",
            "**/*.ps1",
            // Config & Binary Ignores
            "**/.gitattributes",
            "**/.gitignore",
            "**/.prettierignore",
            "**/.prettierrc",
            "**/LICENSE",
            "**/CNAME",
            "**/*.png",
            "**/*.opju",
            "**/*.mht",
            "**/*.pdf",
            "**/*.kt",
            "**/*.kts",
            "**/*.pro",
            "**/gradlew",
            "**/gradle/**",
            "**/build.gradle.kts",
            "**/settings.gradle.kts",
            // Problematic/Experimental JS
            "adaptive-learning.js",
            "ai-powered-tutoring.js",
            "**/*.sql",
            "**/*.txt",
            "**/*.csv",
            "**/*.xml",
            "**/*.bat",
            "**/*.jsonl",
            "**/.pylintrc",
            "**/.dockerignore",
            "**/*cripts and loader*",
            "**/*.webp",
            "**/*.properties",
            "**/android-app/**",
            // Starsector game folder - too many files causes EMFILE error
            "**/Starsector/**",
            "Starsector/"
        ]
    },
    // Browser/Client-side configuration
    {
        files: ["*.js", "!backend/**/*.js", "!stellar-ai-cli/**/*.js", "!count-exoplanets.js", "!download-new-music.js", "!extract-wix-graph.js", "!package-cli.js", "!setup-music.js", "!kepler_data_parsed.js"],
        plugins: {
            security,
            sonarjs
        },
        languageOptions: {
            ecmaVersion: "latest",
            sourceType: "module",
            globals: {
                KEPLER_DATABASE: "readonly",
                authManager: "readonly",
                supabase: "readonly",
                SUPABASE_CONFIG: "readonly",
                USE_SUPABASE: "readonly",
                puter: "readonly",
                LargeExoplanetLoader: "readonly",
                console: "readonly",
                document: "readonly",
                window: "readonly",
                localStorage: "readonly",
                sessionStorage: "readonly",
                fetch: "readonly",
                setTimeout: "readonly",
                setInterval: "readonly",
                clearTimeout: "readonly",
                clearInterval: "readonly",
                requestAnimationFrame: "readonly",
                cancelAnimationFrame: "readonly",
                TextEncoder: "readonly",
                TextDecoder: "readonly",
                crypto: "readonly",
                btoa: "readonly",
                atob: "readonly",
                alert: "readonly",
                confirm: "readonly",
                location: "readonly",
                AbortController: "readonly",
                showModal: "readonly",
                hideModal: "readonly",
                IntersectionObserver: "readonly",
                Audio: "readonly",
                URL: "readonly",
                Blob: "readonly",
                FileReader: "readonly",
                FormData: "readonly",
                MutationObserver: "readonly",
                Event: "readonly",
                CustomEvent: "readonly",
                WebSocket: "readonly",
                Chart: "readonly",
                THREE: "readonly",
                PerformanceObserver: "readonly",
                CompressionStream: "readonly",
                DecompressionStream: "readonly",
                faceapi: "readonly",
                tf: "readonly",
                ort: "readonly",
                cocoSsd: "readonly",
                Tesseract: "readonly",
                cv: "readonly",
                // Browser APIs
                ResizeObserver: "readonly",
                event: "readonly",
                navigator: "readonly",
                performance: "readonly",
                indexedDB: "readonly",
                caches: "readonly",
                // Exoplanet Pioneer Game Classes
                SupabaseService: "readonly",
                AlienEcosystem: "readonly",
                CraftingManager: "readonly",
                DroneController: "readonly",
                OrbitalManager: "readonly",
                ShipDesigner: "readonly",
                FleetManager: "readonly",
                DiplomacyManager: "readonly",
                TradeManager: "readonly",
                AchievementManager: "readonly",
                EventManager: "readonly",
                MultiplayerManager: "readonly",
                PerformanceManager: "readonly",
                MilitarySystem: "readonly",
                GalaxyView: "readonly",
                PlanetGenerator: "readonly",
                getComputedStyle: "readonly",
                ImageData: "readonly",
                customElements: "readonly",
                CSS: "readonly",
                ScrollTimeline: "readonly",
                SharedWorker: "readonly",
                gemini: "readonly",
                global: "readonly",
                EventTarget: "readonly",
                SupabaseAuthManager: "readonly",
                StarSystemBuilder: "readonly",
                requestIdleCallback: "readonly",
                prompt: "readonly",
                navigator: "readonly",
                ReputationSystem: "readonly",
                GEMINI_API_KEY: "readonly",
                Headers: "readonly",
                // Missing Browser Globals
                Image: "readonly",
                File: "readonly", // Browser Global
                ethers: "readonly", // Library Global
                performance: "readonly",
                URLSearchParams: "readonly",
                speechSynthesis: "readonly",
                SpeechSynthesisUtterance: "readonly",
                caches: "readonly",
                indexedDB: "readonly",
                Notification: "readonly",
                Intl: "readonly",
                Response: "readonly",
                // Missing Node/CommonJS Globals (for mixed files)
                module: "readonly",
                require: "readonly",
                process: "readonly",
                exports: "readonly",
                __dirname: "readonly"
            }
        },
        rules: {
            // Code Quality Rules
            "no-unused-vars": ["warn", { "argsIgnorePattern": "^_", "varsIgnorePattern": "^_" }],
            "no-console": "off", // Console logging is intentional for debugging
            "no-undef": "error",
            "no-redeclare": "error",
            "no-unreachable": "error",
            "no-duplicate-case": "error",
            "no-empty": "warn",
            "no-extra-semi": "warn",
            "no-func-assign": "error",
            "no-inner-declarations": "error",
            "no-sparse-arrays": "error",
            "no-unused-labels": "warn",
            "no-useless-escape": "warn",
            "no-var": "warn",
            "prefer-const": "warn",
            "eqeqeq": ["warn", "always"],
            "curly": ["warn", "multi-line"],
            "no-throw-literal": "error",
            "prefer-arrow-callback": "warn",

            // Best Practices
            "no-eval": "error",
            "no-implied-eval": "error",
            "no-new-func": "error",
            "no-script-url": "error",
            "no-iterator": "warn",
            "no-proto": "warn",
            "no-return-assign": "warn",
            "no-self-compare": "error",
            "no-sequences": "warn",
            "no-throw-literal": "error",
            "no-unmodified-loop-condition": "warn",
            "no-unused-expressions": "warn",
            "no-useless-call": "warn",
            "no-useless-concat": "warn",
            "no-void": "warn",
            "radix": "warn",
            "wrap-iife": ["warn", "any"],

            // Security Rules
            "no-new-wrappers": "warn",
            "no-array-constructor": "warn",
            "no-new-object": "warn",
            "no-param-reassign": ["warn", { "props": false }],

            // Security Plugin Rules (detect-object-injection disabled - too many false positives)
            "security/detect-object-injection": "off",
            "security/detect-non-literal-fs-filename": "warn",
            "security/detect-non-literal-regexp": "warn",
            "security/detect-non-literal-require": "warn",
            "security/detect-unsafe-regex": "error",
            "security/detect-buffer-noassert": "warn",
            "security/detect-child-process": "warn",
            "security/detect-disable-mustache-escape": "warn",
            "security/detect-eval-with-expression": "error",
            "security/detect-no-csrf-before-method-override": "warn",
            "security/detect-possible-timing-attacks": "warn",
            "security/detect-pseudoRandomBytes": "warn",

            // SonarJS Plugin Rules (only valid rules)
            "sonarjs/cognitive-complexity": ["warn", 15],
            "sonarjs/no-duplicate-string": "warn",
            "sonarjs/no-identical-expressions": "error",
            "sonarjs/no-use-of-empty-return-value": "warn",
            "sonarjs/prefer-immediate-return": "warn",
            "sonarjs/prefer-object-literal": "warn",
            "sonarjs/prefer-single-boolean-return": "warn",

            // Complexity
            "complexity": ["warn", 20],
            "max-depth": ["warn", 5],
            "max-lines-per-function": ["warn", { "max": 200, "skipBlankLines": true, "skipComments": true }],
            "max-params": ["warn", 5],
            "max-statements": ["warn", 30]
        }
    },
    // Node.js/Backend configuration
    {
        files: ["backend/**/*.js", "stellar-ai-cli/**/*.js", "count-exoplanets.js", "download-new-music.js", "extract-wix-graph.js", "package-cli.js", "setup-music.js"],
        plugins: {
            security,
            sonarjs
        },
        languageOptions: {
            ecmaVersion: "latest",
            sourceType: "script",
            globals: {
                require: "readonly",
                module: "readonly",
                exports: "readonly",
                __dirname: "readonly",
                __filename: "readonly",
                process: "readonly",
                console: "readonly",
                Buffer: "readonly",
                global: "readonly"
            }
        },
        rules: {
            "no-unused-vars": ["warn", { "argsIgnorePattern": "^_", "varsIgnorePattern": "^_" }],
            "no-console": "off",
            "no-undef": "error",
            "radix": "warn",
            "complexity": ["warn", 25],
            "max-statements": ["warn", 40],

            // Security Plugin Rules (Backend)
            "security/detect-object-injection": "off",
            "security/detect-non-literal-fs-filename": "warn",
            "security/detect-non-literal-regexp": "warn",
            "security/detect-non-literal-require": "warn",
            "security/detect-unsafe-regex": "error",
            "security/detect-child-process": "error",
            "security/detect-eval-with-expression": "error",

            // SonarJS Plugin Rules (Backend)
            "sonarjs/cognitive-complexity": ["warn", 20],
            "sonarjs/no-duplicate-string": "warn",
            "sonarjs/no-identical-expressions": "error"
        }
    }
];
